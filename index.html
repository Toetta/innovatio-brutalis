<!doctype html>
<html lang="sv">
<head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LGJK9XKDZB"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-LGJK9XKDZB');
  </script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Innovatio Brutalis | CNC, 3D-print & produktutveckling i Malmö</title>

  <meta name="description" content="Utvecklingspartner i Malmö inom CNC-fräsning, lasergravyr, 3D-print i PPA-CF och PVC samt 3D-scanning. Från behovsanalys och CAD till prototyp och småserieproduktion.">

  <link rel="canonical" href="https://www.innovatio-brutalis.se/">

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/logo-square-48x48.png" sizes="48x48">
  <link rel="apple-touch-icon" href="/logo-square-180x180.png" sizes="180x180">
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#262425">

  <!-- Hreflang -->
  <link rel="alternate" href="https://www.innovatio-brutalis.se/" hreflang="sv-se">
  <link rel="alternate" href="https://www.innovatio-brutalis.se/en/" hreflang="en">
  <link rel="alternate" href="https://www.innovatio-brutalis.se/" hreflang="x-default">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="Innovatio Brutalis">
  <meta property="og:locale" content="sv_SE">
  <meta property="og:title" content="Innovatio Brutalis | CNC, 3D-print & produktutveckling i Malmö">
  <meta property="og:description" content="Utvecklingspartner i Malmö inom CNC-fräsning, lasergravyr, 3D-print i PPA-CF och PVC samt 3D-scanning. Projekt och verktyg – inklusive FU-Bookkeeping.">
  <meta property="og:url" content="https://www.innovatio-brutalis.se/">
  <meta property="og:image" content="https://www.innovatio-brutalis.se/assets/og-image.jpg">
  <meta property="og:image:type" content="image/jpeg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Innovatio Brutalis – förhandsbild">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Innovatio Brutalis | CNC, 3D-print & produktutveckling i Malmö">
  <meta name="twitter:description" content="Utvecklingspartner i Malmö inom CNC-fräsning, lasergravyr, 3D-print i PPA-CF och PVC samt 3D-scanning. Inkl. FU-Bookkeeping.">
  <meta name="twitter:image" content="https://www.innovatio-brutalis.se/assets/og-image.jpg">
  <meta name="twitter:image:alt" content="Innovatio Brutalis – förhandsbild">

  <!-- CSS (absolut sökväg = fungerar överallt) -->
  <link rel="stylesheet" href="/css/style.css">

  <meta name="ib-topbar-cta-label" content="Kontakt">
  <meta name="ib-topbar-cta-href" content="#kontakt">

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Person",
        "@id": "https://www.innovatio-brutalis.se/#person",
        "name": "Malkus Arlemark",
        "url": "https://www.innovatio-brutalis.se/",
        "sameAs": [
          "https://www.linkedin.com/in/malkus-arlemark-2b996311/"
        ],
        "worksFor": {
          "@id": "https://www.innovatio-brutalis.se/#org"
        }
      },
      {
        "@type": "EngineeringCompany",
        "@id": "https://www.innovatio-brutalis.se/#org",
        "name": "Innovatio Brutalis",
        "url": "https://www.innovatio-brutalis.se/",
        "logo": "https://www.innovatio-brutalis.se/assets/logo.png",
        "image": "https://www.innovatio-brutalis.se/assets/og-image.jpg",
        "email": "m.arlemark@innovatio-brutalis.se",
        "founder": {
          "@id": "https://www.innovatio-brutalis.se/#person"
        },
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Malmö",
          "addressRegion": "Skåne",
          "addressCountry": "SE"
        },
        "areaServed": "SE",
        "description": "Innovatio Brutalis arbetar tidigt i utvecklingskedjan — från analys av behov till verifierad komponent.",
        "sameAs": [
          "https://www.linkedin.com/in/malkus-arlemark-2b996311/"
        ]
      }
    ]
  }
  </script>

</head>

<body>
  <div class="container">

    <!-- GLOBAL NAVIGATION (injectas av site.js) -->
    <div id="site-topbar"></div>
    <script defer src="/assets/site.js"></script>
    <script defer src="/assets/site-deeplinks.js"></script>

    <section class="hero">
      <div class="brand-hero">
        <picture>
          <source srcset="/assets/logo.webp" type="image/webp">
          <img src="/assets/logo.png" alt="Innovatio Brutalis logo">
        </picture>
      </div>

      <h1>Industridesign & teknisk produktutveckling</h1>

      <p class="tagline">
        Innovatio Brutalis arbetar tidigt i utvecklingskedjan — från analys av behov och problemformulering till konceptutveckling,
        konstruktion (CAD), prototypframtagning och lågvolymproduktion.
      </p>

      <div class="spotify-hero" aria-label="Spotify">
        <button id="spotifyPlayBtn" class="btn small" type="button">▶ Spela en slumpad låt</button>
        <div id="spotifyStatus" class="spotify-status" style="margin-top:8px;opacity:.8"></div>
      </div>

      
    </section>

    <section class="grid">
      <article class="card" data-card-id="home-overview">
        <h2>Utvecklingskedja</h2>
        <p>
          Från behovsanalys och kravbild till verifierad komponent i metall eller avancerade polymerer.
        </p>

        <ul>
          <li>Problemanalys & funktionsnedbrytning</li>
          <li>Konstruktion (CAD) med DFM</li>
          <li>Prototyp & verifiering</li>
          <li>Enstyck & småserier</li>
        </ul>

        <hr class="sep">

        <h2>Snabblänkar</h2>
        <ul>
          <li><a href="/engineering/">Engineering & analys</a></li>
          <li><a href="/automotive/">Automotive</a></li>
          <li><a href="/cnc/">CNC & lasergravyr</a></li>
          <li><a href="/print/">3D-print</a></li>
          <li><a href="/scan/">3D-scanning</a></li>
        </ul>
      </article>

      <aside class="card" data-card-id="home-press">
        <h2>Press</h2>
        <a class="press-thumb"
          href="https://www.sydsvenskan.se/malmo/han-gor-okrossbara-glasogonbagar-till-sonen-i-en-3d-skrivare/"
          target="_blank" rel="noopener">
          <img src="/assets/press-sydsvenskan.jpg" alt="Sydsvenskan: okrossbara glasögonbågar">
          <div class="press-copy">
            <div class="press-title">Läs artikeln</div>
            <div class="press-desc">Innovatio Brutalis uppmärksammades i Sydsvenskan för utveckling av slagtåliga 3D-printade glasögonbågar.</div>
          </div>
        </a>

        <a class="press-thumb"
          href="/assets/haparanda-small.pdf" target="_blank" rel="noopener">
          <img src="/assets/haparanda-thumbnail.jpg" alt="Lambretta Cometa 75 — äventyr till Haparanda">
          <div class="press-copy">
            <div class="press-title">Haparanda-äventyret</div>
            <div class="press-desc">Lambretta Cometa 75 — Haparanda - Malmö</div>
          </div>
        </a>

        <h2>LinkedIn</h2>
        <p>
          <a href="https://www.linkedin.com/in/malkus-arlemark-2b996311/" target="_blank" rel="noopener">
            Malkus Arlemark
          </a>
        </p>
      </aside>
    </section>

    <section class="card" id="kontakt" data-card-id="contact" style="margin-top:28px;">
      <h2>Kontakt</h2>
      <p>För förfrågningar eller offertunderlag:</p>

      <div class="kv">
        <div>E-post</div>
        <div><a href="mailto:m.arlemark@innovatio-brutalis.se">m.arlemark@innovatio-brutalis.se</a></div>

        <div>Plats</div>
        <div>Malmö, Sverige</div>

        <div>Org.nr</div>
        <div>770314-3516</div>
      </div>
    </section>

    <footer>
      <div>Innovatio Brutalis™ — Varumärket är föremål för registrering hos PRV (Sverige).</div>
      <div style="margin-top:6px">© <span id="y"></span> Innovatio Brutalis</div>
    </footer>

    <script src="/spotify-player.js"></script>
    <script>
      // Din playlist som “pool” om ingen veckans låt är satt:
      const PLAYLIST_ID = "7h1c4DGKumkFVXH2N8eMFu";

      // (Valfritt) Veckans låt – sätt till en track-URL eller spotify:track:... annars null
      const WEEKLY_TRACK = null;

      // Din Spotify Client ID från dashboard
      // Tips: du kan även spara den i webbläsaren (clientId är inte hemlig):
      // localStorage.setItem("spotify_client_id", "DIN_CLIENT_ID");
      let SPOTIFY_CLIENT_ID = "c8efeac0956c4a9f831bb9238e23f5c3";
      try {
        const savedClientId = localStorage.getItem("spotify_client_id");
        if (savedClientId) {
          const candidate = String(savedClientId).trim();
          if (candidate && candidate !== "FYLL_I_DIN_CLIENT_ID") {
            SPOTIFY_CLIENT_ID = candidate;
          }
        }
      } catch (_) {}

      // Viktigt: måste matcha exakt en Redirect URI du lagt in i Spotify dashboard
      const isLocal =
        location.hostname === "127.0.0.1" ||
        location.hostname === "localhost" ||   // ok att det finns här som detection
        location.hostname === "::1";

      const REDIRECT_URI = isLocal
        ? "http://127.0.0.1:8000/callback.html"
        : "https://www.innovatio-brutalis.se/callback.html";

      const statusEl = document.getElementById("spotifyStatus");
      const playBtn  = document.getElementById("spotifyPlayBtn");

      function setStatus(t){ if (statusEl) statusEl.textContent = t || ""; }

      function hasClientId(){
        return Boolean(SPOTIFY_CLIENT_ID) && SPOTIFY_CLIENT_ID !== "FYLL_I_DIN_CLIENT_ID";
      }

      function hasValidToken(){
        try {
          const t = localStorage.getItem("spotify_access_token");
          const exp = Number(localStorage.getItem("spotify_token_expires_at") || 0);
          if (!t || !exp) return false;
          return Date.now() <= exp;
        } catch (_) {
          return false;
        }
      }

      function getSpotifySite(){
        return window.SpotifySite;
      }

      let PUBLIC_TRACK_URLS = [];

      function pickRandom(arr){
        if (!Array.isArray(arr) || arr.length === 0) return null;
        return arr[Math.floor(Math.random() * arr.length)];
      }

      function normalizeTrackUrlOrUri(v){
        if (!v) return null;
        const s = String(v).trim();
        if (!s) return null;
        if (s.startsWith("spotify:track:")) {
          const id = s.split(":")[2];
          return id ? `https://open.spotify.com/track/${id}` : null;
        }
        const m = s.match(/open\.spotify\.com\/track\/([A-Za-z0-9]+)/);
        if (m?.[1]) return `https://open.spotify.com/track/${m[1]}`;
        return null;
      }

      function openUrlInSpotify(url){
        try {
          if (!url) return false;
          window.open(url, "_blank", "noopener,noreferrer");
          return true;
        } catch (_) {
          return false;
        }
      }

      function openPlaylistInSpotify(){
        return openUrlInSpotify(`https://open.spotify.com/playlist/${PLAYLIST_ID}`);
      }

      function openRandomPublicTrackInSpotify(){
        // If you set WEEKLY_TRACK to a track URL/URI, it overrides randomness.
        const weekly = normalizeTrackUrlOrUri(WEEKLY_TRACK);
        if (weekly) return openUrlInSpotify(weekly);

        const pick = normalizeTrackUrlOrUri(pickRandom(PUBLIC_TRACK_URLS));
        if (pick) return openUrlInSpotify(pick);

        return openPlaylistInSpotify();
      }

      async function loadPublicTracks(){
        try {
          const r = await fetch(`/assets/spotify-tracks.json?ts=${Date.now()}`, { cache: "no-store" });
          if (!r.ok) return;
          const j = await r.json();
          const tracks = Array.isArray(j) ? j : j?.tracks;
          if (!Array.isArray(tracks)) return;
          PUBLIC_TRACK_URLS = tracks.map(normalizeTrackUrlOrUri).filter(Boolean);
        } catch (_) {
          // ignore
        }
      }

      // Init: läs token om den redan finns i localStorage
      (async () => {
        try {
          await loadPublicTracks();
          // For public visitors: no login required; Play will open Spotify.
          // If the user already has a token, we can attempt in-browser playback.
          if (!hasValidToken()) {
            setStatus("Spotify: klicka Spela (öppnar en slumpad låt i Spotify). ");
            return;
          }

          const s = getSpotifySite();
          if (!s || !hasClientId()) {
            setStatus("Spotify: inloggad (token finns) men saknar konfig för web-uppspelning.");
            return;
          }

          const ok = await s.init({ clientId: SPOTIFY_CLIENT_ID, redirectUri: REDIRECT_URI });
          setStatus(ok ? "Spotify: inloggad." : "Spotify: klicka Spela.");
        } catch (e) {
          console.error(e);
          setStatus("Spotify: init-fel (se console).");
        }
      })();

      if (playBtn) {
        playBtn.addEventListener("click", async () => {
          setStatus("Spotify: klick…");
          const s = getSpotifySite();
          // Public mode: if no valid token, just open Spotify (works for everyone)
          if (!hasValidToken() || !s || !hasClientId()) {
            setStatus("Spotify: öppnar en slumpad låt i Spotify…");
            openRandomPublicTrackInSpotify();
            return;
          }

          // Säkerställ att SpotifySite har konfig (token finns redan)
          try {
            await s.init({
              clientId: SPOTIFY_CLIENT_ID,
              redirectUri: REDIRECT_URI,
            });
          } catch (e) {
            console.error(e);
            setStatus("Spotify: init-fel — öppnar i Spotify.");
            openRandomPublicTrackInSpotify();
            return;
          }

          setStatus("Startar… (kräver Premium för web-uppspelning)");

          try {
            const track = await s.chooseOneTrack({
              weeklyTrack: WEEKLY_TRACK,
              playlistId: PLAYLIST_ID,
            });

            // Försök spela i webbläsaren via Web Playback SDK
            const playedInWeb = await s.playInBrowser(track.uri);

            if (playedInWeb) {
              setStatus(`Spelar i webben: ${track.name || "låt"}`);
            } else {
              // Fallback: öppna i Spotify
              s.openInSpotify(track);
              setStatus("Öppnade i Spotify (fallback).");
            }
          } catch (e) {
            console.error(e);
            const msg = String(e?.message || e || "");
            if (msg.includes("Spotify API 403")) {
              const now = Date.now();
              let last = 0;
              try { last = Number(sessionStorage.getItem("spotify_403_relogin_at") || 0); } catch (_) {}

              // Avoid endless consent loops if 403 is persistent (playlist truly inaccessible)
              if (last && (now - last) < 60_000) {
                setStatus("Spotify: 403 Forbidden. Detta verkar inte vara scope-issue längre. Kontrollera att PLAYLIST_ID är en playlist du har access till (public/egen/colab) och att appen tillåter ditt konto i Spotify Dashboard (Users & Access).");
                return;
              }

              try { sessionStorage.setItem("spotify_403_relogin_at", String(now)); } catch (_) {}

              // In practice, 403 is often playlist access. Avoid looping; open Spotify instead.
              setStatus("Spotify: 403 Forbidden — öppnar i Spotify.");
              try {
                // keep tokens as-is; user might still be able to play via app
              } catch (_) {}
              openRandomPublicTrackInSpotify();
            } else {
              setStatus(msg ? ("Fel: " + msg) : "Kunde inte spela just nu.");
            }
          }
        });
      }
    </script>

  </div>
</body>
</html>
